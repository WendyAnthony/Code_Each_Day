---
title: "ER390 Project Proposal"
subtitle: "Vizualizing HAT's GOE Monitoring Data"
author: "Wendy Anthony"
date: "2025/09/01"
output:
  html_document:
    df_print: paged
    toc: yes
    toc_depth: 3
    toc_float: yes
    number_sections: yes
  pdf_document:
    latex_engine: xelatex
    toc: yes
  word_document:
    toc: yes
    toc_depth: '3'
# mainfont: Monaco #default Times Roman
# fontsize: 12pt # use with mainfont: Monaco
---

```{r, setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, load-libraries, echo=FALSE, results=FALSE, results='hide', message=FALSE}
library(shiny)
library(tidyverse)
library(plotly)
library(leaflet)
library(DiagrammeR)
```

# The Idea behind submitting this project proposal
- I am a student in UVic's Restoration of Natural Systems program, as well as the equivalent of a double major in Environmental Studies and Geography, and a life-long learner with an interest in making a significant contribution to the local restoration community, and I'm looking to assist a willing community partner through the creation of a Final Restoration Project 
- Nancy Shackelford (RNS Director) suggested that I might consider helping HAT GOE Monitoring Project of Southern Vancouver Island by creating a tool for vizualizing GOE Monitoring Data. 

# Background
- Data used for this proposal is from two tables in the report that HAT used as a model for their GOE Monitoring Project (Malloff & Shackelford, 2024)
- use data to represent data in a visual manner, to make it more understandable than a table of numbers (?? CITE ??)

# Project Partner
- I have already spoken to Vanessa Brownlee, Habitat Restoration Coordinator, Habitat Acquisition Trust (HAT) on 2025-08-27, who was very interested in my proposed project idea, and seemed willing to consider letting me start in Fall 2025.
- I have already spoken briefly to Board Chair Andy MacKinnon at the HAT Social 2025-08-27, and he seemed keen to know I was interested in doing my RNS Final Project with HAT and was looking forward to know more about what I had in mind. 

# Project Goals (overarching purpose)
- I propose to create a customized, automatic coding and reporting tool, with tutorial instructions, using open-source tools like R libraries which can be used by non-coders at HAT for formatting and interactively visualizing data collected at multiple sites for their Garry Oak Ecosystem (GOE) Monitoring Program, to determine what stories the collected data may illustrate much easier than tables of numbers
- a tool for communicating

# Project Objectives (actionable targets)
- Analyze the collected data to understand the underlying structure, ensure the use of consistent naming protocols for variables, and format data to be usable for use with data visualization code
- Create data visualization code, using RStudio, RMarkdown, and RShiny, to create appropriate visualizations to enable a better understanding of the collected data
- Customize data tools to reflect a consistent presence that uses HAT's colours, logos, and plotting themes
- Create RMarkdown documents to automatically download and format data, create data visualizations, produce reports for the whole project and individual sites
- Create scaleable data visualization tools that can have more sites added, sites with different measuring and sensitivity criteria (e.g. First Nations GOE sites)
- Track differences between sites: native species, exotic invasive species, 
- Create custom functions for reading, analyzing, and plotting data 
- Create an interactive, browser-based Shiny app for user-chosen custom-make data visualization plots and maps for selected location(s), and variables, with the ability to download the resulting data, html widgets, plot images, and interactive web maps


# What I need
## From HAT
- permission to participate in a HAT-related project
- access to HAT GOE Monitoring Data, including metadata
- support, input, and feedback 
- I met with Vanessa Brownlee at the HAT Social 2025-08-27, who asked that I send her further information about my proposed project, and though still new to her position, she seemed to be willing for me to start this project in Fall 2025 semester 

## From RNS
- support and supervision from RNS Nancy Shackelford, particularly before she goes on sabatical July 2026 

# What I can offer
- I am a self-motivated, low maintenance student, very interested in the natural environment, and who loves to continue learning in meaningful ways, and help create useful digital tools to enhance the learning experience
- I have extensive experience with coding using `R`, expecially with data visualization and mapping techniiques, often learning new method through self-researched knowledge as the need arose. 
- My long-standing, keen interest in local Garry Oak Ecosystems, including helping remove invasive species and plant native species in a variety of local restoration projects, and while also observing changes over time, I am intrigued by learning how to visualize monitoring measurements to see if the data can help recognize if there are any patterns of change over time and location. 
- I have already spent more than 30 hours (during August 2025), creating, cleaning, formatting, and filtering example data (Malloff & Shackelford, 2024), and then reviewing and learning the new-to-me R code I would need to complete this project. I feel confident I will be able to learn any other R code as will be deemed needed after consultation with HAT, and receiving HAT DATA to analyze its structure and formats 
- I can also assist HAT with any raw data clean-up as needed, including creating R code for calculating any indices from the measurement data

- (see Gantt Chart for proposed timeline and Mermaid Flow Chart for Methods Workflow)
- Continue to research and learn how to code in Shiny reactively in order to make interactive data choices (e.g. a drop-down list of Sites) respond to a prior data choice (e.g. Subregions), in order to filter the results of specific interest. I'd like to extend these interactive choice reactions to the selection of monitoring variables being measured in order to be able to make custom-made visualizations and analysis with only a few clicks 
- Sign any data confidentiality agreements as may be required by HAT
- Consult with HAT restoration monitor team to explore and understand the nature of the collected data, data format (forms, spreadsheets), the variables that are being measured, any indices to be calculated using the collected data, what questions they would like to explore with the data
- Create a Project folder, with subfolders for R scripts, raw data, processed data, images, reports, download a copy of the current data (including any meta data e.g. measurement units, description of measurement variable, date collected, etc)
- Clean data, check for errors, inconsistencies, data quality, calculate values from raw data measurements
- create file and variable naming protocols
- Create data visualization plot charts that appropriate to reflect the nature of the variables being measured
- Documents my methods, successes, and failures in the process of the project
- Continual research for finding appropriate R coding methods, and to contribute to writing my final paper

# Proposed Deliverables

## Data Visualizations
- data tables, chart plots, interactive maps 
- for individual sites
- for comparing sites (all together, or grouped by subregion)
- statistical analysis, and data summary stats (depending on HAT goals)

## RMarkdown Data Processing Document 
- for data downloading, cleaning, and formatting data visualizations 
- explain process for preparing data for use 
- can be used to create HTML, pdf, or Word reports, with table of contents, plot output images, and even code if desired 
- HTML Document includes a linked Table of Contents for easy navigation between sections 

## Customizations
- colour palette for background app
- change default colour palette from pink and blue to something else
- add HAT logo
- add colour to Shiny tabs
- create custom HAT plot chart theme 
- Individual site reports

## Shiny interactive tool 
- https://goe-interact.shinyapps.io/Test-Shiny-GOE-Monitor/ 
- using data processed with RMarkdown document 
- for choosing data variables to visualize in tables, plot charts, and maps 

## Tutorials for using Data visualization Tools
- easy to understand 
- customized 

## Presentation
- The completed project will be presented to HAT, my community partner

## Written report
- The final RNS report will document the work I did to complete this project 
- Report will follow the expectations of RNS program, including format (submit as Word document) and length (5000 words), to eventually be published in the online journal Ecorestoration: RNS Technical Series

# Bibliography
- Malloff, J., & Shackelford, N. (2024). <i>Feeling the Pulse: Monitoring methods and initial outcomes in oak meadow ecosystems.</i> Restoration Futures Lab at the University of Victoria. 

\newpage
# Workflow Graph
```{r ER390-mermaid-graph-shapes, echo=FALSE}
DiagrammeR::DiagrammeR("
graph TB

A1[Wendy]
A2[Vanessa HAT]
A3[Nancy RNS]

A((Start Project))
D(Raw Data)
E(Filtered Data)
F[Variable Names]
K(RMarkdown)
V(DataVisualizations)
R(Reports)
S{Shiny app}
D1((Deiverables))
D2(Data Best practises protocols)
D3(Report Templates)
D4(Automatic Coding templates)
D5(Tutorial: PDF, HTML, video)
D6(Instruction manual)

 A1-->A
 A1-- consult -->A3
 A3-- feedback -->A1
 A2-- feedback -->A1
 A3-- liaise -->A2
 A1-.->|ask for Data|A2
 A2-.->|send raw HAT data|D
 A-- analyze & clean -->D
 D-- results in -->E
 A-- code in -->K
 K-- to create -->V
 V-- using -->F
 F-- in -->E
 V-- used in -->S
 S-- reactively -->E
 S-- produces user-chosen -->V
 A-- produces -->R
 A-- sends -->R
 A-->D1
 S-->D1
 R-->D1
 D2-->D1
 D3-->D1
 D4-->D1
 D5-->D1
 D6-->D1
 
 
 
 style A1 fill:#dff5f0, stroke:#333, stroke-width:2px  
 style A2 fill:#dff5f0, stroke:#333, stroke-width:2px  
 style A3 fill:#dff5f0, stroke:#333, stroke-width:2px  
 style A fill:#c3faca, stroke:#333, stroke-width:3px  
 style D fill:#ddfac3, stroke:#333, stroke-width:3px  
 style D1 fill:#c3faca, stroke:#333, stroke-width:1px  
 style D2 fill:#E5E25F, stroke:#333, stroke-width:1px  
 style D3 fill:#E5E25F, stroke:#333, stroke-width:1px  
 style D4 fill:#E5E25F, stroke:#333, stroke-width:1px  
 style D5 fill:#E5E25F, stroke:#333, stroke-width:1px  
 style D6 fill:#E5E25F, stroke:#333, stroke-width:1px  
 style E fill:#ddfac3, stroke:#333, stroke-width:3px  
 style F fill:#cdd9c3
 style K fill:#E5E25F, stroke:#333, stroke-width:2px  
 style R fill:#E5E25F, stroke:#333, stroke-width:1px  
 style S fill:#E5E25F, stroke:#333, stroke-width:1px  
 style V fill:#E5E25F, stroke:#333, stroke-width:1px  
")
# #3C8937 Forest Green

```

\newpage
# Proposed Timeline
- red coloured items are considered critical  
- grey items are completed  
```{r gantt, echo=FALSE, include=TRUE, message=FALSE}
ER390_gantt <- read.csv("data/ER390-Gantt-Tasks.csv", header = TRUE, sep = ",")
# str(ER390_gantt)
# NOTE: dates need to be chr in order for Gantt code to work properly
# names(ER390_gantt)
# # convert start and end dates from chr to date 
# changes way date is displayed in Gantt
# but now I loose my Gantt 
 # ER390_gantt$start <- as.Date(ER390_gantt$start)
 # ER390_gantt$end <- as.Date(ER390_gantt$end)
# str(ER390_gantt)

library(tidyr)
library(dplyr)
library(DiagrammeR)

mermaid(
  paste0(
    # mermaid "header", each component separated with "\n" (line break)
    "gantt", "\n",
    "dateFormat  YYYY-MM-DD", "\n",
    "title ER390 HAT Data Viz Project Proposed Timeline", "\n",
    # unite the first two columns (task & status) and separate them with ":"
    # then, unite the other columns and separate them with ","
    # this will create the required mermaid "body"
    paste(ER390_gantt %>%
            unite(i, task, status, sep = ":") %>%
            unite(j, i, pos, start, end, sep = ",") %>%
            .$j,
          collapse = "\n"
    ), "\n"
  )
)
  
```

\newpage
***

# Results of Example Data Visualizations 
## Data download and formatting
- Data (in excel or csv format) is uploaded 
- Data is formatted, saved, and managed to be useful for creating visualizations 
- The code has been hidden for this report, highlighting only the resulting plots 

## Load Site Data
<details><summary><b><i>Click to see results of `data`</i></b></summary><p>
```{r, load-data, echo=FALSE, results=FALSE, results='hide', message=FALSE}
## Details doesn't work in pdf - remove when knitting
# Site Data
geo_eccc <- read.csv("data/SiteData-TEST-GOE-Monitor.csv", header = TRUE, sep = ",")
# Site Details
Sites_eccc <- read.csv("data/SiteDetails-TEST-GOE-Monitor.csv", header = TRUE, sep = ",")
```

</p></details>

```{r, echo=FALSE, results=FALSE, results='hide', message=FALSE}
Percentage_ns <- geo_eccc$Proportion_of_native_species * 100
```

```{r, add-column, echo=FALSE, results=FALSE, results='hide', message=FALSE}
geo_eccc <- cbind(geo_eccc, Percentage_ns)
```

```{r, arange-order-df, echo=FALSE, results=FALSE, results='hide', message=FALSE}
Sites_eccc_1 <- Sites_eccc %>% arrange(Sites_eccc$Site)
geo_eccc_1 <- geo_eccc %>% arrange(geo_eccc$Site)
```

```{r, cbind-arranged-df, echo=FALSE, results=FALSE, results='hide', message=FALSE}
geo_eccc_sites <- cbind(Sites_eccc_1, geo_eccc_1)
```

```{r, remove-duplicate-columns, echo=FALSE, results=FALSE, results='hide', message=FALSE}
geo_eccc_sites_1 <- geo_eccc_sites[c(-9,-10)]
```

```{r, rename-columns-baser, echo=FALSE, results=FALSE, results='hide', message=FALSE}
names(geo_eccc_sites_1)[names(geo_eccc_sites_1) == "Land.Manager"] <- "Land_Manager"
names(geo_eccc_sites_1)[names(geo_eccc_sites_1) == "Main.Restoration.Type"] <- "Main_Restoration_Type"
names(geo_eccc_sites_1)[names(geo_eccc_sites_1) == "Restoration.Intensity"] <- "Restoration_Intensity"
names(geo_eccc_sites_1)[names(geo_eccc_sites_1) == "Area.ha"] <- "Area_ha"
```

```{r, create-csv-combined-datasets, echo=FALSE, results=FALSE, results='hide', message=FALSE}
write.csv(geo_eccc_sites_1, "data/geo_eccc_all_site_data.csv", row.names = FALSE)
```

\newpage

# Data Visualization Example Results

## Data Table (Malloff & Shackelford, 2024)

### Full Data Table
- the full table is too wide for use in pdf because variable names are too long
```{r, data table_html, echo=FALSE}
# for html
DT::datatable(geo_eccc_sites_1)
```


### Table Head of Site Information

```{r data-table-pdf-sites, echo=FALSE, warning=FALSE}
# - table is too wide for pdf because variable names are too long

# kable not supported by word
## for pdf use kableExtra::kable to print small version of head
#   kableExtra::kable_styling(latex_options = "hold_position", font_size = 6)

kableExtra::kable(
  head(Sites_eccc_1), booktabs = TRUE, linesep = ""
) %>%
  kableExtra::kable_styling(latex_options = "hold_position", font_size = 6)
```

### Head of Site Data

```{r data-table-pdf-data, echo=FALSE, warning=FALSE}
# - table is too wide for pdf because variable names are too long

# kable not supported by word
## for pdf use kableExtra::kable to print small version of head
#   kableExtra::kable_styling(latex_options = "hold_position", font_size = 6)

kableExtra::kable(
  head(geo_eccc_1), booktabs = TRUE, linesep = ""
) %>%
  kableExtra::kable_styling(latex_options = "hold_position", font_size = 6)
```

\newpage
## Map of Site Locations

### Leaflet Map with Circle Markers 
- Data  is summarized in map marker popups with summary of site data

```{r    aflet_map_circle_markers_sized_radius, echo=FALSE}
# not supported by docx format
# , fig.align = 'center'

geo_eccc_sites_1 <- read.csv("data/geo_eccc_all_site_data.csv")

library(dplyr)
library(leaflet)
library(htmlwidgets) # for responsive web map

title <- '<p style="text-align: center; height: 30px; ">
<span style="font-size:10px;font-weight:bold; background-color: rgba(255, 255, 255, 0.9;");>ECCC GOE 2023 Monitoring Sites</span><br>
<span style="font-size:8px;font-style:italic; background-color: rgba(255, 255, 255, 0.9;">(Malloff & Shackelford, 2024)</span></p>'
 
pal <- colorFactor(c("#d7191c", "#2c7bb6"), domain = c("Saanich Peninsula", "Gulf Islands"))

ECCC_map_2 <- leaflet(geo_eccc_sites_1) %>%
  addProviderTiles("Esri.WorldImagery") %>%
  addCircleMarkers(
             ~ Lng, ~ Lat, 
         
             radius = ~ifelse(Subregion == "Saanich Peninsula", 8, 8),
    fillColor = ~pal(Subregion),
    color = "black",
    weight = 3, # size of circle border
    stroke = TRUE, fillOpacity = 0.5,
             popup = paste0("<b>ECCC GOE 2023 Monitoring Data</b>", "<br>", "<i>(Malloff & Shackelford, 2024)</i>", "<br><br>",
               "<b>Site:</b> ", "<b>", geo_eccc_sites_1$Site, "</b>", "</b>", "<br><br>", "<b>Subregion:</b> ", geo_eccc_sites_1$Subregion, "<br>",
                        "<b>Latitude:</b> ", geo_eccc_sites_1$Lat, "<br>", "<b>Longitude:</b> ", geo_eccc_sites_1$Lng,  "<br><br>",
                        "<b>Land Manager:</b> ", geo_eccc_sites_1$Land_Manager, "<br>",
                        "<b>Main Restoration:</b> ", geo_eccc_sites_1$Main_Restoration_Type, "<br>",
                        "<b>Restoration Intensity:</b> ", geo_eccc_sites_1$Restoration_Intensity, "<br>",
                        "<b> Area:</b> ", geo_eccc_sites_1$Area_ha, " ha",
                        "<br><br>",
                        "<b>Proportion of native species:</b> ", geo_eccc_sites_1$Proportion_of_native_species, "<br>",
                        "<b>Cultural species richness:</b> ", geo_eccc_sites_1$Cultural_species_richness, "<br>",
                        "<b>Exotic species:</b> ", geo_eccc_sites_1$Exotic_species, "<br>",
                        "<b>Trampling:</b> ", geo_eccc_sites_1$Trampling, "<br>",
                        "<b>Herbivory:</b> ", geo_eccc_sites_1$Herbivory, "<br>",
                        "<b>Composite Index:</b> ", geo_eccc_sites_1$Composite_Index, "<br>")) %>%
  setView(-123.44799, 48.64919, 10) %>%
  # add controls
  addMiniMap(width = 100, height = 100, zoomLevelOffset = -4) %>%
  addControl(title, position = "topright") 

# Display map
ECCC_map_2
saveWidget(ECCC_map_2, "output/ECCC_map_2.html")
```

\newpage

## Subregion Plots
- these plots compare a variable of 2 Subregions
```{r, plots_Exotic_species, echo=FALSE, results=FALSE, results='hide', include=FALSE, message=FALSE}
subregion_exsp <- ggplot(geo_eccc, 
                    aes(x = Subregion, y = Exotic_species)) +
                    geom_violin(fill = "seagreen2") +
                    geom_boxplot(width = 0.1, fill = "sandybrown") +
                    theme_minimal() + #get rid of grey background and tick marks 
                    theme(legend.position="none") + #remove legend 
                    theme(axis.text.x = element_text(vjust = 1, size = 9)) +
                    labs(title='Plotting Subregion by Exotic Species',
                      subtitle='ECCC',
                      x = "Subregion", y = "Exotic Species")
subregion_exsp
# plotly won't work here
```


```{r, plots_Percentage_ns, echo=FALSE, results=FALSE, results='hide', include=FALSE, message=FALSE}

subregion_nsp <- ggplot(geo_eccc, 
                    aes(x = Subregion, y = Percentage_ns)) +
                    geom_violin(fill = "seagreen2") +
                    geom_boxplot(width = 0.1, fill = "sandybrown") +
                    theme_minimal() + #get rid of grey background and tick marks 
                    theme(legend.position="none") + #remove legend 
                    theme(axis.text.x = element_text(vjust = 1, size = 9)) +
                    labs(title='Plotting Subregion by Percentage of Native Species',
                      subtitle='ECCC',
                       x = "Subregion", y = "Percentage Native Species")
subregion_nsp
# plotly won't work here
```

### Violin/Bar Plot: Compare Subregions Exotic and Native Species
```{r, cowplot_violin_subr, echo=FALSE}
library(cowplot)

subregion_exsp_1 <- subregion_exsp + labs(title='Exotic Species',
                      subtitle='ECCC (Malloff & Shackelford, 2024)'
                      )

subregion_nsp_1 <- subregion_nsp + labs(title='Native Species',
                      subtitle='ECCC (Malloff & Shackelford, 2024)',
                      caption = "Chart by Wendy Anthony \n 2025-08-27")

plot_grid(subregion_exsp_1, subregion_nsp_1, labels = "AUTO")
```

\newpage

## Site Plots

### Point Plot: Compare Sites by Restoration Intensity
- Sites are ordered by the level of restoration intensity, ranging from high to minimal 
- click data points for tool-tip of data results 

```{r, plots_site_Restoration_Intensity_order_point_1, echo=FALSE}

# Step 1
desired_levels <- c("high", "moderate", "low", "minimal")
# create new df to create desired levels
geo_eccc_sites_2 <- geo_eccc_sites_1
# this changes data type from character to factor
geo_eccc_sites_2$Restoration_Intensity <- factor(geo_eccc_sites_1$Restoration_Intensity, levels = desired_levels)

# step 2
geo_eccc_sites_2 <- geo_eccc_sites_2[order(geo_eccc_sites_2$Restoration_Intensity),]

# values in order now -- ?? how to change to reverse order 
site_restInt_x <- ggplot(geo_eccc_sites_2,
       aes(x = reorder(Site, 
                       -desc(Restoration_Intensity)), 
           y = reorder(Restoration_Intensity, desc(Restoration_Intensity)), color = Subregion)) +
  # reorder y variable axis
  # https://stackoverflow.com/questions/28391850/reverse-order-of-discrete-y-axis-in-ggplot2s
# y = Restoration_Intensity
                    geom_point(shape = 18, size = 2) +
  #geom_bar(stat="identity") +
#  scale_fill_brewer(palette = "Dark2") +
                    theme_minimal() + #get rid of grey background and tick marks 
                    theme(legend.position="bottom") + 
                    theme(axis.text.x = element_text(angle = 25, vjust = 1, hjust=1, size = 7)) +
                    labs(title='Plot Site Restoration Intensity',
                      subtitle='ECCC (Malloff & Shackelford, 2024)',
                      caption = "Chart by Wendy Anthony \n 2025-08-26",
                      x = "Site", y = "Restoration Intensity")

# ggplot
# site_restInt_x

# ggplotly(site_restInt_x)
leg <- list(
  font = list(
    family = "sans-serif",
    size = 8,
    color = "#000"))
# xanchor = "center", too far left
plot <- ggplotly(site_restInt_x)
plot <- plot %>% layout(legend = list(leg, x = 0.15, y = -0.5, orientation = 'h', size = 0.025))  
plot <- plot %>% layout(legend = leg)

#plot
ggplotly(plot)
```


